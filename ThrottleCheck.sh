nvidia-smi --query-gpu=index,gpu_name,fan.speed,pstate,clocks_throttle_reasons.hw_thermal_slowdown,clocks_throttle_reasons.sw_thermal_slowdown,memory.used,memory.total,utilization.gpu,temperature.gpu,power.draw,power.limit --format=csv,noheader,nounits | while IFS=',' read -r id name fan_speed pstate hw_throttle sw_throttle mem_used mem_total gpu_util temp power_draw power_limit; do mem_percent=$(awk "BEGIN {printf \"%.2f\", ($mem_used/$mem_total)*100}"); power_draw_rounded=$(awk "BEGIN {printf \"%d\", $power_draw}"); power_limit_rounded=$(awk "BEGIN {printf \"%d\", $power_limit}"); if [[ "$hw_throttle" != " Not Active" ]]; then hw_throttle="\\033[1;101m$hw_throttle \\033[0m"; else hw_throttle="\\033[1;90m$hw_throttle \\033[0m"; fi; if [[ "$sw_throttle" != " Not Active" ]]; then sw_throttle="\\033[1;95m$sw_throttle\\033[0m"; else sw_throttle="\\033[1;90m$sw_throttle\\033[0m"; fi; cpu_mem_info=$(top -bn1 | grep "Cpu(s)\|Mem" | awk '/Cpu\(s\)/ {cpu_usage = int($2 + $4)} /MiB Mem/ {mem_total = int($4); mem_used = int($8)} END {printf "CPU_util: %d%%   RAM: %d / %dMiB", cpu_usage, mem_used, mem_total}'); echo -e "\nid:$id   $name   vRAM: $mem_used / $mem_total ($mem_percent%)   GPU_util: $gpu_util%   Power: $power_draw_rounded / $power_limit_rounded W   perf_state: $pstate"; echo -e "GPUtemp: $tempÂ°C   Fan: $fan_speed%   HW-throttle: $hw_throttle   SW-throttle: $sw_throttle* -- $cpu_mem_info"; done
